# Vectra Guard Configuration
# Simple, clean, rock solid protection

# ============================================
# GUARD LEVEL (Auto-Detection Recommended)
# ============================================

guard_level:
  # Security level: auto (recommended), low, medium, high, paranoid
  # 
  # 'auto' intelligently detects context and adjusts protection:
  #   - Local dev (feature branches) → low protection
  #   - Staging environments → high protection  
  #   - Production environments → paranoid (requires approval)
  #   - Ambiguous context → medium (safe default)
  #
  # Detection considers: git branch, URLs, DB names, file paths, command strings
  # When in doubt, chooses the most protective level (safety first!)
  level: auto
  
  # Override auto-detection: VECTRA_GUARD_LEVEL=low vg exec ...
  allow_user_bypass: true
  bypass_env_var: VECTRAGUARD_BYPASS

# ============================================
# ENVIRONMENT DETECTION
# ============================================

# Teach Vectra Guard your organization's patterns
production_indicators:
  # Git branches that indicate production
  branches:
    - main
    - master
    - production
    - release
  
  # Keywords in URLs, hostnames, database names, paths
  keywords:
    - prod
    - production
    - prd
    - live
    - staging
    - stg
    # Add your org's patterns:
    # - uat
    # - preprod

# ============================================
# LOGGING
# ============================================

logging:
  format: json  # Options: json, text

# ============================================
# SECURITY POLICIES
# ============================================

policies:
  # Git Operations
  monitor_git_ops: true
  block_force_git: true  # Block git push --force
  
  # Production Environment Detection
  detect_prod_env: true
  
  # SQL Detection (only flag destructive operations by default)
  only_destructive_sql: true
  
  # Commands always allowed (safe operations)
  allowlist:
    - "echo *"
    - "ls *"
    - "cat *"
    - "pwd"
    - "git status"
    - "git diff"
    - "git log"
    - "npm install"
    - "npm test"
    - "npm run build"
  
  # Commands blocked or requiring approval
  denylist:
    - "rm -rf /"
    - "sudo rm"
    - ":(){ :|:& };:"  # fork bomb
    - "curl * | sh"
    - "wget * | bash"
    - "git push --force"
    - "DROP DATABASE"
    - "DROP TABLE"

# ============================================
# ENVIRONMENT VARIABLE PROTECTION (Optional)
# ============================================

env_protection:
  enabled: true
  masking_mode: partial  # full, partial, hash, fake
  block_dotenv_read: true

# ============================================
# SANDBOX EXECUTION (Phase 1-7 Implementation)
# ============================================

sandbox:
  # Enable sandbox execution
  enabled: true
  
  # Execution mode: auto (smart), always, risky (high-risk only), never
  # 'auto' is recommended - sandbox medium+ risk commands automatically
  mode: auto
  
  # Security level: permissive, balanced, strict, paranoid
  # balanced = good isolation without sacrificing speed
  security_level: balanced
  
  # Runtime: docker, podman, process
  # docker = most compatible, process = fastest (Linux only)
  runtime: docker
  
  # Container image to use
  image: ubuntu:22.04
  
  # Execution timeout (seconds)
  timeout: 300
  
  # Cache strategy for faster dev cycles
  enable_cache: true
  # cache_dirs:
  #   - ~/.npm
  #   - ~/.cargo
  #   - ~/go/pkg
  
  # Network mode: none, restricted, full
  # restricted = allow outbound, block inbound (recommended)
  network_mode: restricted
  
  # Seccomp profile path (optional, for strict/paranoid)
  # seccomp_profile: /path/to/seccomp-profile.json
  
  # Environment variables to pass through
  env_whitelist:
    - HOME
    - USER
    - PATH
    - SHELL
    - TERM
    - PWD
  
  # Custom bind mounts (optional)
  # bind_mounts:
  #   - host_path: /path/on/host
  #     container_path: /path/in/container
  #     read_only: false
  
  # Observability and metrics
  enable_metrics: true
  log_output: false
  
  # Trust store path (for "approve and remember")
  # trust_store_path: ~/.vectra-guard/trust.json

# ============================================
# DEVELOPER PRESET (Quick Start)
# ============================================
# 
# For a "just works" developer experience, use these settings:
# 
# guard_level:
#   level: low              # Minimal friction
# 
# sandbox:
#   enabled: true
#   mode: auto              # Smart sandboxing
#   security_level: permissive  # Fast, less isolated
#   enable_cache: true      # Reuse deps
#   network_mode: full      # No network restrictions
# 
# This gives you:
# - Low-friction development
# - Automatic sandboxing for risky commands
# - Fast execution with caching
# - "Approve and remember" for trusted commands

# ============================================
# NOTES
# ============================================
# 
# For advanced configurations and presets, see: docs/CONFIGURATION.md
# 
# Quick override examples:
#   VECTRA_GUARD_LEVEL=low vg exec "risky command"     # Temporary low protection
#   VECTRA_GUARD_LEVEL=paranoid vg exec "prod deploy"  # Force paranoid mode
# 
# The 'auto' level is recommended - let Vectra Guard be smart about context!
